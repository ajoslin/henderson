!function(n){function e(n,e){var t=Error.call(this,"Transition from "+n+" to "+e+" is not allowed");return t.name="IllegalTransitionException",t.prev=n,t.attempt=e,t}function t(n){function t(n){return r[n]||[]}var r={},i={transitions:n.states,current:n.initial,error:n.error};return i.bind=function(n,e){return r[n]=r[n]||[],r[n].push(e),i},i.unbind=function(n,e){return n in r&&r[n].indexOf(e)>-1&&r[n].splice(r[n].indexOf(e),1),i},i.on=i.bind,i.go=function(n){function r(e){return e<u.length?[n]:e<s.length?[o]:[o,n]}var o=i.current,c=Array.prototype.slice.call(arguments,1);if(i.transitions[o].indexOf(n)<0)return Promise.reject(new e(o,n));var u=t("after:"+o),f=t("before:"+n),a=t(n),l=t("*"),s=u.concat(f,a),d=u.length+f.length;return new Promise(function(e,t){s.concat(l).reduce(function(e,t,o){return o===d&&(i.current=n),e.then(t.apply(t,r(o).concat(c)))},Promise.resolve()).then(function(){i.current=n,e()})})},i}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:"undefined"!=typeof self?self.StateMachine=t:n.StateMachine=t}(this);